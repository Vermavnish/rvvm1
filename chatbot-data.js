// RVVM School Chatbot Data with Direct API Integration
// тЪая╕П WARNING: API key is visible in source code

const GEMINI_API_KEY = 'AIzaSyCCT_l1DjDypxGx94YXiXQ1ryMMimuBf2k'; // тЖР PASTE YOUR API KEY HERE
const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';

// School Information Context
const schoolContext = `
School Name: Radhika Vilas Vidya Mandir (RVVM)
Location: SH-1B, Chakia (Dalpatpur), Ballia, Uttar Pradesh
Contact: 070712 50111, +91 70712 50999
Email: radhikavilaschakia@gmail.com
WhatsApp: +91 70712 50999
Website: https://rvvm.netlify.app

Timings: Monday to Saturday, 8:00 AM - 3:00 PM (Sunday holiday)
Classes: Nursery to Class 10
Medium: Nursery to 8th (English), 9th-10th (Hindi)
Board: U.P. Board

Facilities: Science Lab, Computer Lab, Playground, 24/7 Security, Power Backup, Fire Safety, School Bus, Scholarship for poor/orphan/handicapped students

Management:
Chairman: Mr. Ravi Shankar Singh
Director: Mr. Bhaskar Singh
Founder: Lt. Vindhyachal Prasad Singh (1924-2009)
Governed by: Shri Vindhyachal Seva Samiti

Admission: Visit school office during working hours or contact via phone/email/WhatsApp
`;

// Predefined Responses (Fallback + Fast Answers)
const chatbotData = {
    timing: {
        patterns: [
            "school timing", "school timings", "school time", "school hours", "school schedule",
            "scool timing", "schol timing", "skool timing", "school timin", "school timming",
            "school ka samay", "school kitne baje khulta", "school kab khulta hai",
            "scool ka samay", "iskool timing", "school ka smay", "skool ka time",
            "school ka tym", "timing kya hai", "school kb se kb tak", "time btao school ka",
            "kitne baje se kitne baje tak", "school open time", "school band kab hota"
        ],
        response: `ЁЯУЕ *RVVM School Timing:*

ЁЯХЧ *рд╕реЛрдорд╡рд╛рд░ рд╕реЗ рд╢рдирд┐рд╡рд╛рд░:* рд╕реБрдмрд╣ 8:00 AM рд╕реЗ рджреЛрдкрд╣рд░ 3:00 PM рддрдХ

ЁЯУ┤ *рд░рд╡рд┐рд╡рд╛рд░:* рдЕрд╡рдХрд╛рд╢ (Holiday)

тП░ School рд╕рдордп рдкрд░ рдЦреБрд▓рддрд╛ рд╣реИ, рдХреГрдкрдпрд╛ рд╕рдордп рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред

ЁЯУЮ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ: 070712 50111`
    },

    admission: {
        patterns: [
            "admission", "admissions", "admission process", "how to get admission",
            "admission procedure", "how to apply", "application process",
            "admision", "admissn", "addmission", "admisssion", "admition",
            "dakhla", "pravesh", "admission kaise le", "dakhla kaise le", "pravesh kaise le",
            "school me dakhla", "admission lena hai", "admission chahiye",
            "dakhila", "dakhla kese le", "pravesh kese le", "admisn kese le"
        ],
        response: `ЁЯУЭ *RVVM Admission Process:*

тЬЕ *Process Steps:*
1. School office рдореЗрдВ working hours рдореЗрдВ visit рдХрд░реЗрдВ
2. Admission form рднрд░реЗрдВ
3. рдЖрд╡рд╢реНрдпрдХ documents submit рдХрд░реЗрдВ
4. Fees payment рдХрд░реЗрдВ

ЁЯХЧ *Visit Timing:* рд╕реЛрдорд╡рд╛рд░ рд╕реЗ рд╢рдирд┐рд╡рд╛рд░, 8:00 AM - 3:00 PM

ЁЯУЮ *Contact for Admission:*
тШОя╕П Phone: 070712 50111 / +91 70712 50999
ЁЯУз Email: radhikavilaschakia@gmail.com
ЁЯТм WhatsApp: +91 70712 50999

ЁЯМР *Online Form:* https://rvvm.netlify.app рдкрд░ рдЬрд╛рдХрд░ admission enquiry form рднрд░реЗрдВ

ЁЯУН *Address:* SH-1B, Chakia (Dalpatpur), Ballia, UP`
    },

    contact: {
        patterns: [
            "contact", "contact details", "phone number", "contact number", "mobile number",
            "email", "email address", "how to contact", "phone", "call", "whatsapp number",
            "contect", "cantact", "kontact", "contct", "contact detals",
            "sampark", "phone number kya hai", "contact kaise kare", "number do",
            "phone number batao", "email kya hai", "whatsapp number", "kaise contact kare"
        ],
        response: `ЁЯУЮ *RVVM Contact Details:*

тШОя╕П *Phone Numbers:*
ЁЯУ▒ 070712 50111
ЁЯУ▒ +91 70712 50999

ЁЯУз *Email:*
тЬЙя╕П radhikavilaschakia@gmail.com

ЁЯТм *WhatsApp:*
ЁЯУ▓ +91 70712 50999

ЁЯМР *Website:*
ЁЯФЧ https://rvvm.netlify.app

ЁЯУШ *Facebook:*
ЁЯСЙ Radhika Vilas Vidya Mandir

ЁЯХЧ *Contact Timing:* рд╕реЛрдорд╡рд╛рд░ рд╕реЗ рд╢рдирд┐рд╡рд╛рд░, 8:00 AM - 3:00 PM`
    },

    address: {
        patterns: [
            "address", "location", "where is school", "school address", "school location",
            "where is rvvm", "school kaha hai", "direction", "map", "how to reach",
            "addres", "adress", "adres", "locaton", "loction",
            "pata", "school ka pata", "address batao", "kaha hai school", "school kahaan hai",
            "kaise pahunche", "location kya hai", "address kya hai"
        ],
        response: `ЁЯУН *RVVM School Address:*

ЁЯПл *Full Address:*
Radhika Vilas Vidya Mandir
SH-1B, Chakia (Dalpatpur)
Ballia, Uttar Pradesh
India

ЁЯЧ║я╕П *Landmark:* Chakia, Ballia

ЁЯЪМ *How to Reach:*
School SH-1B highway рдкрд░ рд╕реНрдерд┐рдд рд╣реИред Chakia area рдореЗрдВ рдкреВрдЫрдХрд░ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред

ЁЯЪЧ School bus facility рднреА рдЙрдкрд▓рдмреНрдз рд╣реИред

ЁЯУЮ Direction рдХреЗ рд▓рд┐рдП call рдХрд░реЗрдВ: 070712 50111

ЁЯМР Map: https://rvvm.netlify.app рдкрд░ visit рдХрд░реЗрдВ`
    },

    facilities: {
        patterns: [
            "facilities", "facility", "what facilities", "school facilities", "infrastructure",
            "what is available", "amenities", "lab", "library", "playground", "computer lab",
            "facilites", "facilitys", "facilty",
            "suvidha", "suvidhayen", "school me kya hai", "kya kya hai", "school ki suvidha"
        ],
        response: `ЁЯПл *RVVM Facilities:*

ЁЯФм *Science Laboratory*
ЁЯТ╗ *Computer Lab*
тЪ╜ *Playground*
тЪб *Power Backup (24/7)*
ЁЯЫбя╕П *24/7 Security*
ЁЯФе *Fire Safety*
ЁЯЪМ *School Bus/Transport Facility*
ЁЯОУ *Scholarship* (рдЧрд░реАрдм, рдЕрдирд╛рде рдФрд░ рд╡рд┐рдХрд▓рд╛рдВрдЧ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП)

ЁЯОн *Extra Activities:*
тАв Annual Function
тАв Cultural Programs
тАв Sports Activities

ЁЯПЖ RVVM рдореЗрдВ students рдХреА safety aur education рдХреЗ рд▓рд┐рдП рд╕рднреА modern facilities рдЙрдкрд▓рдмреНрдз рд╣реИрдВред

ЁЯУЮ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА: 070712 50111`
    },

    classes: {
        patterns: [
            "classes", "which classes", "class available", "nursery to which class",
            "classes available", "which standard", "what classes",
            "clasess", "clases", "which clasess",
            "kaun kaun si class", "class kya kya hai", "konsi class tak", "nursery se kitni class"
        ],
        response: `ЁЯУЪ *RVVM Classes Available:*

ЁЯОТ *Nursery рд╕реЗ Class 10th рддрдХ*

ЁЯС╢ Nursery
ЁЯУЦ Class 1 to 8
ЁЯУШ Class 9
ЁЯУЩ Class 10

ЁЯУЦ *Medium of Instruction:*
тАв Nursery to 8th: *English Medium*
тАв Class 9th to 10th: *Hindi Medium*

ЁЯУЛ *Board:* U.P. Board (Uttar Pradesh Board)

ЁЯОУ Quality education рдЫреЛрдЯреЗ рдмрдЪреНрдЪреЛрдВ рд╕реЗ рд▓реЗрдХрд░ 10th рддрдХ рдХреЗ students рдХреЗ рд▓рд┐рдПред

ЁЯУЮ Class-wise details: 070712 50111`
    },

    fees: {
        patterns: [
            "fees", "fee structure", "school fees", "how much fees", "fees kitni hai",
            "monthly fees", "admission fees", "total fees", "fee details",
            "fess", "fee structre", "school fes", "kitna paisa lagta hai", "fees batao"
        ],
        response: `ЁЯТ░ *RVVM Fees Information:*

ЁЯФТ Fees structure рдХреА detailed information publicly available рдирд╣реАрдВ рд╣реИред

ЁЯУЮ *Fees рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП contact рдХрд░реЗрдВ:*

тШОя╕П Phone: 070712 50111 / +91 70712 50999
ЁЯУз Email: radhikavilaschakia@gmail.com
ЁЯТм WhatsApp: +91 70712 50999

ЁЯОУ *Special Facility:*
School рдЧрд░реАрдм, рдЕрдирд╛рде рдФрд░ рд╡рд┐рдХрд▓рд╛рдВрдЧ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП *Scholarship* provide рдХрд░рддрд╛ рд╣реИред

ЁЯПл Office visit рдХрд░рдХреЗ complete fee details рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

ЁЯХЧ Visit Time: рд╕реЛрдорд╡рд╛рд░ рд╕реЗ рд╢рдирд┐рд╡рд╛рд░, 8:00 AM - 3:00 PM`
    },

    website: {
        patterns: [
            "website", "website link", "online", "site", "web address", "url",
            "websit", "websyte", "webiste", "website kya hai", "website link do"
        ],
        response: `ЁЯМР *RVVM Online Presence:*

ЁЯФЧ *Official Website:*
https://rvvm.netlify.app

ЁЯУШ *Facebook Page:*
Radhika Vilas Vidya Mandir

ЁЯУ▒ *Online Admission Form:*
Website рдкрд░ рдЬрд╛рдХрд░ admission enquiry form рднрд░ рд╕рдХрддреЗ рд╣реИрдВред

ЁЯТ╗ Website рдкрд░ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛:
тАв School information
тАв Admission details
тАв Contact information
тАв Photo gallery
тАв Updates & announcements

ЁЯМР Visit рдХрд░реЗрдВ рдФрд░ school рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ complete information рдкрд╛рдПрдВ!`
    },

    management: {
        patterns: [
            "chairman", "director", "principal", "management", "who is chairman",
            "who is director", "school head", "management team", "owner",
            "charman", "directr", "managment", "chairman kaun hai", "director kaun hai"
        ],
        response: `ЁЯСФ *RVVM Management:*

ЁЯСитАНЁЯТ╝ *Chairman:*
Mr. Ravi Shankar Singh

ЁЯСитАНЁЯТ╝ *Director:*
Mr. Bhaskar Singh

ЁЯХКя╕П *Founder:*
Lt. Vindhyachal Prasad Singh (1924-2009)

ЁЯПЫя╕П *Governed by:*
Shri Vindhyachal Seva Samiti

ЁЯОУ *Principal Information:*
Principal details рдХреЗ рд▓рд┐рдП school office рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред

ЁЯУЮ *Management рд╕реЗ contact:*
тШОя╕П 070712 50111 / +91 70712 50999
ЁЯУз radhikavilaschakia@gmail.com

ЁЯПл RVVM experienced aur dedicated management team рдХреЗ guidance рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред`
    },

    default: {
        response: `тЭУ *Sorry, рдореБрдЭреЗ рдЖрдкрдХрд╛ рд╕рд╡рд╛рд▓ рд╕рдордЭ рдирд╣реАрдВ рдЖрдпрд╛ред*

рдЖрдк рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ:

ЁЯУЭ *Admission Process*
ЁЯХЧ *School Timing*
ЁЯУЮ *Contact Details*
ЁЯУН *School Address*
ЁЯПл *Facilities*
ЁЯУЪ *Classes Available*
ЁЯТ░ *Fees Structure*
ЁЯМР *Website*
ЁЯСФ *Management*

рдпрд╛ рдлрд┐рд░ direct contact рдХрд░реЗрдВ:
тШОя╕П 070712 50111 / +91 70712 50999
ЁЯУз radhikavilaschakia@gmail.com
ЁЯТм WhatsApp: +91 70712 50999`
    }
};

// Rate Limiting
let apiCallCount = 0;
const MAX_API_CALLS = 250; // Google Gemini free tier daily limit

// Call Gemini AI API Directly
async function callGeminiAPI(userQuery) {
    // Check daily limit
    if (apiCallCount >= MAX_API_CALLS) {
        console.log('тЪая╕П Daily API limit reached (250/250)');
        return null;
    }

    try {
        console.log('ЁЯдЦ Calling Gemini AI directly...');
        
        const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: [{
                    parts: [{
                        text: `You are RVVM school's helpful virtual assistant. Answer in Hindi/English mix (Hinglish) based on user's language preference.

School Information:
${schoolContext}

Important Instructions:
- Keep answers short and concise (2-3 lines maximum)
- Use emojis to make responses engaging
- If information is not available in school context, politely ask user to contact: 070712 50111
- Be friendly, helpful, and professional
- Match the language style of the user's question

User Question: ${userQuery}

Helpful Answer:`
                    }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 200,
                    topP: 0.95,
                    topK: 40
                }
            })
        });

        if (!response.ok) {
            const errorText = await response.text();
            console.error('тЭМ API Error:', response.status, errorText);
            throw new Error(`API returned ${response.status}`);
        }

        const data = await response.json();
        
        // Validate response structure
        if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
            console.error('тЭМ Invalid API response structure');
            throw new Error('Invalid response from AI');
        }

        apiCallCount++;
        const aiResponse = data.candidates[0].content.parts[0].text;
        
        console.log(`тЬЕ AI Response generated | Calls today: ${apiCallCount}/${MAX_API_CALLS}`);
        
        return aiResponse;
        
    } catch (error) {
        console.error('тЭМ Gemini API Error:', error.message);
        return null;
    }
}

